{% extends "base.html" %}

{% block content %}
<div class="container py-4">
    <!-- Profile Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card border-0 shadow-lg animate-fade-in-up">
                <div class="card-body p-4">
                    <div class="row align-items-center">
                        <!-- Avatar and Welcome -->
                        <div class="col-md-6 mb-4 mb-md-0">
                            <div class="d-flex align-items-center">
                                <div class="position-relative me-4">
                                    {% if user.avatar %}
                                        <img src="{{ url_for('static', filename='avatars/' + user.avatar) }}" 
                                             alt="{{ session.username }}'s avatar" 
                                             class="rounded-circle border border-3 border-primary"
                                             style="width: 80px; height: 80px; object-fit: cover;"
                                             onerror="this.src='https://ui-avatars.com/api/?name={{ session.username }}&background=667eea&color=fff&size=80'">
                                    {% else %}
                                        <div class="bg-primary text-white rounded-circle d-flex align-items-center justify-content-center"
                                             style="width: 80px; height: 80px; font-size: 2rem;">
                                            {{ session.username[0]|upper }}
                                        </div>
                                    {% endif %}
                                    <span class="position-absolute bottom-0 end-0 bg-success border border-2 border-white rounded-circle p-1"></span>
                                </div>
                                <div>
                                    <h1 class="h2 mb-1">Welcome, {{ session.username }}! ðŸ‘‹</h1>
                                    <p class="text-muted mb-2">Ready for today's challenge?</p>
                                    <a href="{{ url_for('profile') }}" class="btn btn-outline-primary btn-sm">
                                        <i class="bi bi-person-circle me-1"></i>View Profile
                                    </a>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Stats -->
                        <div class="col-md-6">
                            <div class="row g-3">
                                <div class="col-6 col-sm-3">
                                    <div class="text-center">
                                        <div class="display-6 fw-bold text-primary">{{ user.points }}</div>
                                        <small class="text-muted">Points</small>
                                    </div>
                                </div>
                                <div class="col-6 col-sm-3">
                                    <div class="text-center">
                                        <div class="display-6 fw-bold text-success">Lvl {{ user.level }}</div>
                                        <small class="text-muted">Level</small>
                                    </div>
                                </div>
                                <div class="col-6 col-sm-3">
                                    <div class="text-center">
                                        <div class="display-6 fw-bold text-warning">{{ user.streak }} ðŸ”¥</div>
                                        <small class="text-muted">Streak</small>
                                    </div>
                                </div>
                                <div class="col-6 col-sm-3">
                                    <div class="text-center">
                                        <div class="display-6 fw-bold text-info">{{ user.total_quizzes }}</div>
                                        <small class="text-muted">Quizzes</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Daily Challenge -->
    <div class="row mb-4">
        <div class="col-12">
            {% if not challenge_completed %}
            <div class="card border-0 shadow-lg animate-fade-in-up">
                <div class="card-header bg-gradient-primary text-white d-flex justify-content-between align-items-center">
                    <h3 class="mb-0"><i class="bi bi-star-fill me-2"></i>Daily Challenge</h3>
                    <span class="badge bg-warning text-dark fs-6">+{{ daily_challenge.bonus_points }} bonus points!</span>
                </div>
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <h4 class="card-title mb-2">{{ daily_challenge.subject }} Quiz</h4>
                            <p class="card-text mb-3">
                                Complete today's {{ daily_challenge.difficulty|capitalize }} difficulty quiz to earn extra points!
                                Test your knowledge in {{ daily_challenge.subject }} and climb the leaderboard.
                            </p>
                            <div class="d-flex gap-2 mb-3">
                                <span class="badge bg-info">{{ daily_challenge.difficulty|capitalize }}</span>
                                <span class="badge bg-secondary">{{ daily_challenge.questions }} questions</span>
                                <span class="badge bg-success">{{ daily_challenge.time_limit }} min time</span>
                            </div>
                        </div>
                        <div class="col-md-4 text-center text-md-end">
                            <a href="{{ url_for('quiz', subject=daily_challenge.subject, difficulty=daily_challenge.difficulty) }}?daily=true" 
                               class="btn btn-warning btn-lg px-4 py-3 fw-bold">
                                <i class="bi bi-trophy me-2"></i>Accept Challenge
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            {% else %}
            <div class="card border-0 shadow-lg animate-fade-in-up border-success">
                <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
                    <h3 class="mb-0"><i class="bi bi-check-circle-fill me-2"></i>Daily Challenge Complete!</h3>
                    <span class="badge bg-light text-success fs-6">+{{ daily_challenge.bonus_points }} points earned!</span>
                </div>
                <div class="card-body text-center py-4">
                    <i class="bi bi-award-fill display-1 text-success mb-3"></i>
                    <h4 class="card-title mb-3">Great job! You've completed today's challenge!</h4>
                    <p class="card-text text-muted mb-4">
                        Come back tomorrow for a new challenge and keep your streak alive!
                    </p>
                    <div class="d-flex justify-content-center gap-3">
                        <div class="text-center">
                            <div class="display-5 fw-bold text-success">{{ user.streak }}</div>
                            <small class="text-muted">Day Streak</small>
                        </div>
                        <div class="text-center">
                            <div class="display-5 fw-bold text-primary">{{ user.points }}</div>
                            <small class="text-muted">Total Points</small>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Recent Achievements -->
    {% if achievements %}
    <div class="row mb-4">
        <div class="col-12">
            <div class="card border-0 shadow-sm animate-fade-in-up">
                <div class="card-header bg-light">
                    <h3 class="mb-0"><i class="bi bi-trophy me-2"></i>Recent Achievements</h3>
                </div>
                <div class="card-body">
                    <div class="row row-cols-2 row-cols-md-4 row-cols-lg-6 g-3">
                        {% for ach in achievements %}
                        <div class="col">
                            <div class="text-center p-3 bg-light rounded-3 hover-shadow">
                                <div class="mb-2">
                                    <i class="bi bi-{{ ach.achievement_icon }} fs-1 text-warning"></i>
                                </div>
                                <h6 class="mb-1">{{ ach.achievement_name }}</h6>
                                <small class="text-muted">{{ ach.date_earned }}</small>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Choose Your Challenge -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h2 class="h3 mb-0"><i class="bi bi-compass me-2"></i>Choose Your Challenge</h2>
            </div>
        </div>
    </div>

    <!-- Subject Cards -->
    <div class="row g-4 mb-5">
        <!-- Mathematics Card -->
        <div class="col-md-6 col-lg-4">
            <div class="card border-0 shadow-lg h-100 animate-fade-in-up">
                <div class="card-header bg-gradient-primary text-white">
                    <div class="d-flex align-items-center">
                        <div class="bg-white bg-opacity-25 rounded-circle p-3 me-3">
                            <i class="bi bi-calculator fs-2"></i>
                        </div>
                        <div>
                            <h3 class="h4 mb-0">Mathematics</h3>
                            <small class="opacity-75">Numbers, Equations & Logic</small>
                        </div>
                    </div>
                </div>
                <div class="card-body d-flex flex-column">
                    <p class="card-text mb-4">
                        Test your math skills with various topics from basic arithmetic to advanced calculus.
                        Perfect your problem-solving abilities!
                    </p>
                    <div class="mt-auto">
                        <div class="row g-2 mb-3">
                            <div class="col-4">
                                <div class="text-center p-2 bg-info bg-opacity-10 rounded">
                                    <small class="d-block fw-bold">10</small>
                                    <small class="text-muted">Quizzes</small>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="text-center p-2 bg-success bg-opacity-10 rounded">
                                    <small class="d-block fw-bold">85%</small>
                                    <small class="text-muted">Avg Score</small>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="text-center p-2 bg-warning bg-opacity-10 rounded">
                                    <small class="d-block fw-bold">3</small>
                                    <small class="text-muted">Topics</small>
                                </div>
                            </div>
                        </div>
                        <div class="d-grid gap-2">
                            <a href="{{ url_for('quiz', subject='Math', difficulty='easy') }}" 
                               class="btn btn-outline-success">Easy</a>
                            <a href="{{ url_for('quiz', subject='Math', difficulty='medium') }}" 
                               class="btn btn-outline-warning">Medium</a>
                            <a href="{{ url_for('quiz', subject='Math', difficulty='hard') }}" 
                               class="btn btn-outline-danger">Hard</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Science Card -->
        <div class="col-md-6 col-lg-4">
            <div class="card border-0 shadow-lg h-100 animate-fade-in-up">
                <div class="card-header bg-gradient-info text-white">
                    <div class="d-flex align-items-center">
                        <div class="bg-white bg-opacity-25 rounded-circle p-3 me-3">
                            <i class="bi bi-flask fs-2"></i>
                        </div>
                        <div>
                            <h3 class="h4 mb-0">Science</h3>
                            <small class="opacity-75">Biology, Chemistry & Physics</small>
                        </div>
                    </div>
                </div>
                <div class="card-body d-flex flex-column">
                    <p class="card-text mb-4">
                        Explore the wonders of science. From microscopic organisms to cosmic phenomena, 
                        challenge your scientific knowledge.
                    </p>
                    <div class="mt-auto">
                        <div class="row g-2 mb-3">
                            <div class="col-4">
                                <div class="text-center p-2 bg-info bg-opacity-10 rounded">
                                    <small class="d-block fw-bold">8</small>
                                    <small class="text-muted">Quizzes</small>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="text-center p-2 bg-success bg-opacity-10 rounded">
                                    <small class="d-block fw-bold">78%</small>
                                    <small class="text-muted">Avg Score</small>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="text-center p-2 bg-warning bg-opacity-10 rounded">
                                    <small class="d-block fw-bold">4</small>
                                    <small class="text-muted">Topics</small>
                                </div>
                            </div>
                        </div>
                        <div class="d-grid gap-2">
                            <a href="{{ url_for('quiz', subject='Science', difficulty='easy') }}" 
                               class="btn btn-outline-success">Easy</a>
                            <a href="{{ url_for('quiz', subject='Science', difficulty='medium') }}" 
                               class="btn btn-outline-warning">Medium</a>
                            <a href="{{ url_for('quiz', subject='Science', difficulty='hard') }}" 
                               class="btn btn-outline-danger">Hard</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- History Card -->
        <div class="col-md-6 col-lg-4">
            <div class="card border-0 shadow-lg h-100 animate-fade-in-up">
                <div class="card-header bg-gradient-warning text-dark">
                    <div class="d-flex align-items-center">
                        <div class="bg-dark bg-opacity-25 rounded-circle p-3 me-3">
                            <i class="bi bi-clock-history fs-2"></i>
                        </div>
                        <div>
                            <h3 class="h4 mb-0">History</h3>
                            <small class="opacity-75">Ancient to Modern Times</small>
                        </div>
                    </div>
                </div>
                <div class="card-body d-flex flex-column">
                    <p class="card-text mb-4">
                        Journey through time and explore significant historical events, figures, 
                        and civilizations that shaped our world.
                    </p>
                    <div class="mt-auto">
                        <div class="row g-2 mb-3">
                            <div class="col-4">
                                <div class="text-center p-2 bg-info bg-opacity-10 rounded">
                                    <small class="d-block fw-bold">12</small>
                                    <small class="text-muted">Quizzes</small>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="text-center p-2 bg-success bg-opacity-10 rounded">
                                    <small class="d-block fw-bold">92%</small>
                                    <small class="text-muted">Avg Score</small>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="text-center p-2 bg-warning bg-opacity-10 rounded">
                                    <small class="d-block fw-bold">5</small>
                                    <small class="text-muted">Eras</small>
                                </div>
                            </div>
                        </div>
                        <div class="d-grid gap-2">
                            <a href="{{ url_for('quiz', subject='History', difficulty='easy') }}" 
                               class="btn btn-outline-success">Easy</a>
                            <a href="{{ url_for('quiz', subject='History', difficulty='medium') }}" 
                               class="btn btn-outline-warning">Medium</a>
                            <a href="{{ url_for('quiz', subject='History', difficulty='hard') }}" 
                               class="btn btn-outline-danger">Hard</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Quizzes -->
    {% if recent_quizzes %}
    <div class="row">
        <div class="col-12">
            <div class="card border-0 shadow-lg animate-fade-in-up">
                <div class="card-header bg-light">
                    <h3 class="mb-0"><i class="bi bi-clock-history me-2"></i>Recent Quizzes</h3>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th class="ps-4">Subject</th>
                                    <th>Difficulty</th>
                                    <th>Score</th>
                                    <th>Time</th>
                                    <th class="pe-4">Date</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for quiz in recent_quizzes %}
                                <tr class="align-middle">
                                    <td class="ps-4">
                                        <div class="d-flex align-items-center">
                                            {% if quiz.subject == 'Math' %}
                                                <i class="bi bi-calculator text-primary fs-5 me-3"></i>
                                            {% elif quiz.subject == 'Science' %}
                                                <i class="bi bi-flask text-info fs-5 me-3"></i>
                                            {% elif quiz.subject == 'History' %}
                                                <i class="bi bi-clock-history text-warning fs-5 me-3"></i>
                                            {% else %}
                                                <i class="bi bi-question-circle text-secondary fs-5 me-3"></i>
                                            {% endif %}
                                            <div>
                                                <h6 class="mb-0">{{ quiz.subject }}</h6>
                                                <small class="text-muted">{{ quiz.topic }}</small>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        {% if quiz.difficulty == 'easy' %}
                                            <span class="badge bg-success">{{ quiz.difficulty|capitalize }}</span>
                                        {% elif quiz.difficulty == 'medium' %}
                                            <span class="badge bg-warning">{{ quiz.difficulty|capitalize }}</span>
                                        {% else %}
                                            <span class="badge bg-danger">{{ quiz.difficulty|capitalize }}</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <div class="d-flex align-items-center">
                                            <div class="progress flex-grow-1 me-2" style="height: 8px;">
                                                {% set percentage = (quiz.score / quiz.total_questions * 100)|int %}
                                                <div class="progress-bar 
                                                    {% if percentage >= 80 %}bg-success
                                                    {% elif percentage >= 60 %}bg-warning
                                                    {% else %}bg-danger{% endif %}" 
                                                     style="width: percentage ">
                                                </div>
                                            </div>
                                            <span class="fw-bold">{{ quiz.score }}/{{ quiz.total_questions }}</span>
                                        </div>
                                    </td>
                                    <td>
                                        <i class="bi bi-clock me-1"></i>
                                        {{ quiz.time_taken }} min
                                    </td>
                                    <td class="pe-4">
                                        {{ quiz.completed_at }}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</div>

<!-- Additional CSS -->
<style>
    .hover-shadow:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0,0,0,0.1) !important;
        transition: all 0.3s ease;
    }
    
    .bg-gradient-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
    }
    
    .bg-gradient-info {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%) !important;
    }
    
    .bg-gradient-warning {
        background: linear-gradient(135deg, #fa709a 0%, #fee140 100%) !important;
    }
    
    .progress-bar {
        border-radius: 4px;
    }
    
    .animate-fade-in-up {
        animation: fadeInUp 0.6s ease-out;
    }
    
    .card {
        border-radius: 15px;
        overflow: hidden;
    }
    
    .card-header {
        border-bottom: none;
    }
    
    .table th {
        font-weight: 600;
        text-transform: uppercase;
        font-size: 0.85rem;
        letter-spacing: 0.5px;
    }
    
    .table td {
        vertical-align: middle;
    }
    
    .badge {
        padding: 0.35em 0.65em;
        font-weight: 500;
    }
    
    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    /* Difficulty badges */
    .btn-outline-success:hover {
        background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%) !important;
        color: white !important;
        border-color: transparent !important;
    }
    
    .btn-outline-warning:hover {
        background: linear-gradient(135deg, #fa709a 0%, #fee140 100%) !important;
        color: white !important;
        border-color: transparent !important;
    }
    
    .btn-outline-danger:hover {
        background: linear-gradient(135deg, #ff0844 0%, #ffb199 100%) !important;
        color: white !important;
        border-color: transparent !important;
    }
</style>

<script>
    // Animate elements on scroll
    document.addEventListener('DOMContentLoaded', function() {
        const animatedElements = document.querySelectorAll('.animate-fade-in-up');
        
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.style.opacity = 1;
                    entry.target.style.transform = 'translateY(0)';
                }
            });
        }, {
            threshold: 0.1
        });
        
        animatedElements.forEach(el => {
            el.style.opacity = 0;
            el.style.transform = 'translateY(20px)';
            el.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
            observer.observe(el);
        });
        
        // Initialize tooltips
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
        var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl);
        });
    });
</script>
{% endblock %}